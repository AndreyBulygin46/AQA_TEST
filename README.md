# AQA Python Test Project

Проект автоматизированного тестирования авторизации на сайте https://www.saucedemo.com/

## Описание

Проект содержит автоматизированные тесты для проверки функциональности авторизации на демо-сайте SauceDemo. Реализовано 5 тестовых сценариев с использованием Selenium, Page Object Model и Allure отчетности.

**Статус проекта:** ✅ Все тесты работают корректно и проходят успешно

**Проверено:**
- ✅ Локальный запуск (Windows): все 5 тестов проходят (~55 секунд)
- ✅ Docker запуск (Linux): все 5 тесты проходят (~28 секунд)
- ✅ Headless режим автоматически включается в Docker
- ✅ ChromeDriver автоматически находится и устанавливается

## Требования

- Python 3.10
- Google Chrome браузер
- pip (менеджер пакетов Python)

## Установка

1. Клонируйте репозиторий или скачайте проект

2. Создайте виртуальное окружение (рекомендуется):
```bash
python -m venv venv
```

3. Активируйте виртуальное окружение:
   - Windows:
     ```bash
     venv\Scripts\activate
     ```
   - Linux/Mac:
     ```bash
     source venv/bin/activate
     ```

4. Установите зависимости:
```bash
pip install -r requirements.txt
```

## Запуск тестов

### Локальный запуск

**Примечание:** По умолчанию тесты запускаются с видимым браузером (headless режим отключен для удобства отладки). В Docker headless режим включается автоматически.

1. Запуск всех тестов:
```bash
pytest tests/ -v
```

   Или через python -m:
```bash
python -m pytest tests/ -v
```

2. Запуск тестов с генерацией отчетов Allure:
```bash
pytest tests/ --alluredir=allure-results -v
```

3. Просмотр отчета Allure:
```bash
# Убедитесь, что у вас установлен Allure CLI
# Если нет, установите: https://docs.qameta.io/allure/
allure serve allure-results
```

**Примечание:** ChromeDriver автоматически скачивается и настраивается при первом запуске через `webdriver-manager`. Не требуется ручная установка драйвера.

### Запуск через Docker

**Примечание:** В Docker автоматически включается headless режим (без GUI), так как контейнеры обычно не имеют графического интерфейса.

1. Соберите Docker образ:
```bash
docker build -t aqa-test .
```
   Время сборки: ~2-3 минуты (первая сборка может занять дольше из-за установки Chrome)

2. Запустите тесты в контейнере:
```bash
docker run --rm aqa-test
```

3. Для сохранения отчетов Allure на хост-машину:
```bash
# Windows (PowerShell)
docker run --rm -v ${PWD}/allure-results:/app/allure-results aqa-test

# Linux/Mac
docker run --rm -v $(pwd)/allure-results:/app/allure-results aqa-test
```

## Структура проекта

```
AQA_TEST/
├── pages/                 # Page Object классы
│   ├── __init__.py
│   ├── login_page.py      # Страница логина
│   └── products_page.py   # Страница продуктов
├── tests/                 # Тесты
│   ├── __init__.py
│   └── test_login.py      # Тесты авторизации
├── conftest.py            # Фикстуры pytest
├── requirements.txt       # Зависимости проекта
├── Dockerfile             # Конфигурация Docker
├── README.md              # Этот файл
└── PROJECT_EXPLANATION.md # Подробное описание проекта
```

## Тестовые сценарии

Все тесты проверяют различные сценарии авторизации:

1. **Успешный логин** (`test_successful_login`)
   - Проверка входа с валидными данными (standard_user / secret_sauce)
   - Проверка перехода на страницу продуктов
   - Проверка отображения элементов (заголовок, товары, корзина)

2. **Неверный пароль** (`test_login_with_wrong_password`)
   - Проверка отображения ошибки при неверном пароле
   - Проверка, что остались на странице логина

3. **Заблокированный пользователь** (`test_locked_out_user_login`)
   - Проверка блокировки пользователя locked_out_user
   - Проверка сообщения об ошибке блокировки

4. **Пустые поля** (`test_login_with_empty_fields`)
   - Проверка валидации пустых полей
   - Проверка сообщения об ошибке

5. **Performance glitch user** (`test_performance_glitch_user_login`)
   - Проверка корректной работы при задержках
   - Проверка успешного входа пользователем performance_glitch_user
   - Увеличенный таймаут ожидания (30 секунд)

## Полезные команды

- Запуск конкретного теста:
```bash
pytest tests/test_login.py::TestLogin::test_successful_login -v
```

- Запуск с выводом в консоль (видеть print-ы):
```bash
pytest tests/ -v -s
```

- Запуск только упавших тестов (при повторном запуске):
```bash
pytest --lf -v
```

- Запуск с маркерами (если добавлены):
```bash
pytest -m smoke -v
```

## Решение проблем

### ChromeDriver не найден или тесты зависают
Проект использует `webdriver-manager` для автоматической установки ChromeDriver. Код автоматически находит правильный драйвер, исключая служебные файлы (THIRD_PARTY_NOTICES, LICENSE и т.д.).

Если возникают проблемы:
1. Убедитесь, что установлен Google Chrome
2. При первом запуске драйвер скачается автоматически (требуется интернет-соединение)
3. Если тесты зависают, проверьте интернет-соединение - webdriver-manager скачивает драйвер при первом запуске
4. Проверьте, что используете виртуальное окружение с установленными зависимостями

**Важно:** При первом запуске webdriver-manager может занять некоторое время на скачивание драйвера - это нормально.

### Тесты падают с ошибкой таймаута
- Убедитесь в стабильности интернет-соединения
- Для теста `performance_glitch_user` используется увеличенный таймаут (30 секунд вместо 10)
- При медленном интернете можно увеличить таймауты в `pages/*.py` или `conftest.py`
- Проверьте доступность сайта https://www.saucedemo.com/

### Allure отчеты не открываются
- Убедитесь, что установлен Allure CLI: https://docs.qameta.io/allure/
- Для Windows: скачайте и установите Allure с официального сайта или используйте Scoop: `scoop install allure`
- Альтернатива: используйте `pytest --html=report.html -p no:allure` для HTML отчетов (требуется `pytest-html`)

### Тесты зависают при запуске
Если тесты зависают на моменте создания браузера:
1. Проверьте, что Chrome установлен и доступен
2. Убедитесь, что используется виртуальное окружение с установленными зависимостями
3. Попробуйте запустить с явным указанием Python: `python -m pytest tests/ -v`
4. Если проблема повторяется, попробуйте удалить кэш: `rm -rf .pytest_cache` и переустановить зависимости

## Технические детали

- **Selenium**: 4.15.2
- **Pytest**: 7.4.3
- **Allure-pytest**: 2.13.2
- **WebDriver Manager**: 4.0.1
- **Python**: 3.10+

## Архитектура

Проект использует паттерн **Page Object Model (POM)**:
- `pages/login_page.py` - содержит методы для работы со страницей логина
- `pages/products_page.py` - содержит методы для работы со страницей продуктов
- `tests/test_login.py` - содержит тестовые сценарии
- `conftest.py` - содержит фикстуры pytest (настройка драйвера, страниц)

### Особенности реализации:

- **Автоматическое определение окружения**: код автоматически определяет, запущен ли он в Docker, и включает headless режим соответственно
- **Умный поиск ChromeDriver**: система автоматически находит правильный драйвер, исключая служебные файлы и документы
- **Кросс-платформенность**: код работает на Windows (локально) и Linux (Docker) без изменений

## Дополнительная информация

Для подробного объяснения как работает проект, см. файл `PROJECT_EXPLANATION.md`
